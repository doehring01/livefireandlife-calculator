<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Net Worth Tracker • FIREandLife</title>
  <link rel="stylesheet" href="/styles.css?v=20250811c" />
  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KHKJVXPJQM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config','G-KHKJVXPJQM');
  </script>
  <style>
    :root{
      --bg:#ffffff; --soft:#f7fafc; --border:#e9edf2; --ink:#0f172a; --muted:#475569;
      --accent:#ff6b5d; --accent-ink:#fff;
    }
    body{background:var(--bg); color:var(--ink);}
    .container{max-width:1100px;margin:2rem auto;padding:0 1rem;}
    .grid{display:grid;gap:1rem}
    .grid-12{grid-template-columns:repeat(12,1fr)}
    .span-12{grid-column:span 12} .span-6{grid-column:span 6} .span-4{grid-column:span 4} .span-3{grid-column:span 3}
    .card{background:#fff;border:1px solid var(--border);border-radius:.6rem;padding:1rem}
    .soft{background:var(--soft);border:1px solid var(--border);border-radius:.6rem;padding:1rem}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.55rem;border-bottom:1px solid #eef2f7;vertical-align:middle}
    .actions button{padding:.35rem .55rem;border:1px solid #cbd5e1;border-radius:.35rem;background:#fff}
    .btn{padding:.7rem .9rem;border:none;border-radius:.45rem;background:var(--accent);color:var(--accent-ink);font-size:16px;cursor:pointer}
    .btn.secondary{background:#fff;color:#111;border:1px solid #cbd5e1}
    .tabs{display:flex;gap:.5rem;margin:1rem 0}
    .tabs button{background:#fff;border:1px solid #cbd5e1;border-radius:999px;padding:.5rem .9rem;cursor:pointer}
    .tabs button.active{background:var(--ink);border-color:var(--ink);color:#fff}
    /* Sticky summary bar */
    .summary{position:sticky;top:0;z-index:10;background:var(--bg);padding:.5rem 0;margin-bottom:.5rem}
    /* Accordions */
    .accordion > summary{cursor:pointer;list-style:none;padding:.6rem .25rem;border-bottom:1px solid #eef2f7;font-weight:600}
    .accordion[open] > summary{border-bottom:none}
    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:1rem;z-index:50}
    .modal{max-width:520px;width:100%;background:#fff;border:1px solid var(--border);border-radius:.7rem;padding:1rem}
    label{display:block;font-weight:600;margin-bottom:.25rem}
    input,select{width:100%;padding:.7rem .75rem;border:1px solid #cfd8e3;border-radius:.4rem;font-size:16px;background:#fff}
    small.help{display:block;color:var(--muted);margin-top:.25rem;font-size:.85rem;line-height:1.3}
    /* FAB */
    .fab{position:fixed;right:16px;bottom:16px;border-radius:999px;padding:.85rem 1rem;box-shadow:0 6px 18px rgba(0,0,0,.15)}
    /* Toast */
    #toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111;color:#fff;padding:.6rem .9rem;border-radius:.5rem;opacity:0;pointer-events:none;transition:opacity .25s;z-index:60}
    /* Mobile */
    @media (max-width: 800px){
      .grid-12{grid-template-columns:repeat(6,1fr)}
      .span-6,.span-4,.span-3,.span-12{grid-column:1 / -1}
    }
  </style>
</head>
<body>
<header>
  <nav style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.06);">
    <div class="logo"><img src="/assets/logo-horizontal.png" alt="FIREandLife" style="height:40px;"></div>
    <ul class="nav-links" style="list-style:none;display:flex;gap:1.2rem;margin:0;">
      <li><a href="/">Home</a></li>
      <li><a href="/calculators/" aria-current="page">Calculators</a></li>
      <li><a href="/blog/">Blog</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/contact/">Contact</a></li>
    </ul>
  </nav>
</header>

<main class="container">
  <h1>Net Worth Tracker</h1>
  <p class="muted" style="margin:.25rem 0 1rem">Track your accounts privately in your browser. Mark which assets <strong>count toward FI</strong> (home equity/car usually don’t). Snapshot monthly to build your chart.</p>

  <!-- Sticky summary -->
  <section class="summary grid grid-12">
    <div class="span-3 soft"><strong>Total Assets</strong><div id="totalAssets">$0</div></div>
    <div class="span-3 soft"><strong>Total Liabilities</strong><div id="totalLiabilities">$0</div></div>
    <div class="span-3 soft"><strong>Net Worth</strong><div id="netWorth">$0</div></div>
    <div class="span-3 soft"><strong>FI-Eligible Assets</strong><div id="fiEligibleTotal">$0</div><small class="muted">Items marked “Counts toward FI.”</small></div>
  </section>

  <!-- Tabs -->
  <div class="tabs">
    <button class="active" data-tab="items">Accounts</button>
    <button data-tab="history">History</button>
  </div>

  <!-- Tab: Accounts -->
  <section id="tab-items">
    <div class="grid grid-12">
      <div class="span-6 card">
        <h3 style="margin:.25rem 0">Asset Mix</h3>
        <small class="muted">FI-eligible vs not-eligible highlighted.</small>
        <canvas id="mixChart" height="220" aria-label="Asset mix pie"></canvas>
      </div>
      <div class="span-6 card">
        <details class="accordion" open>
          <summary>Assets</summary>
          <table>
            <thead><tr><th style="text-align:left">Name</th><th>Category</th><th style="text-align:center">FI?</th><th style="text-align:right">Amount</th><th style="text-align:right">Actions</th></tr></thead>
            <tbody id="assetsBody"></tbody>
          </table>
        </details>
        <details class="accordion" open style="margin-top:.5rem">
          <summary>Liabilities</summary>
          <table>
            <thead><tr><th style="text-align:left">Name</th><th>Category</th><th style="text-align:center">—</th><th style="text-align:right">Amount</th><th style="text-align:right">Actions</th></tr></thead>
            <tbody id="liabilitiesBody"></tbody>
          </table>
        </details>
        <details class="soft" style="margin-top:.5rem">
          <summary><strong>What counts as an asset vs liability?</strong></summary>
          <ul class="muted" style="margin:.6rem 0 0 1rem;line-height:1.55">
            <li><strong>Assets:</strong> Checking, Savings, Brokerage, 401k/IRA/HSA, Cash value policy, Home equity, Car value</li>
            <li><strong>Liabilities:</strong> Mortgage, Student loans, Auto loans, Credit cards, Personal loans</li>
            <li><strong>FI-eligible:</strong> Usually Brokerage, 401k/IRA/HSA, Cash. Primary home & car typically <em>not</em> counted, but you can override.</li>
          </ul>
        </details>
      </div>
    </div>
  </section>

  <!-- Tab: History -->
  <section id="tab-history" hidden>
    <div class="card">
      <div style="display:flex;gap:.5rem;flex-wrap:wrap;justify-content:space-between;align-items:center">
        <div>
          <h3 style="margin:.25rem 0">Net Worth History</h3>
          <div class="muted">Snapshot monthly to build your trend.</div>
        </div>
        <div class="row">
          <button class="btn" id="snapshotBtn" type="button">Snapshot this month</button>
          <button class="btn secondary" id="exportCsvBtn" type="button">Export CSV</button>
        </div>
      </div>
      <div style="margin-top:1rem">
        <canvas id="nwChart" height="210" aria-label="Net worth history"></canvas>
      </div>
      <div style="margin-top:1rem;overflow:auto">
        <table>
          <thead><tr><th style="text-align:left">Date</th><th style="text-align:right">Net Worth</th></tr></thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </div>
  </section>
</main>

<!-- FAB: Add item -->
<button id="openFormFab" class="btn fab" aria-haspopup="dialog" aria-controls="itemModal">＋ Add item</button>

<!-- Modal: Add/Edit item -->
<div class="backdrop" id="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle" style="margin:.25rem 0">Add or Edit Item</h3>
    <form id="itemForm" class="grid" style="grid-template-columns:repeat(2,1fr); gap:.75rem; align-items:end">
      <input type="hidden" id="editId" value="">
      <div class="span-12">
        <label for="itemType">Type</label>
        <select id="itemType">
          <option value="asset" selected>Asset</option>
          <option value="liability">Liability</option>
        </select>
      </div>
      <div>
        <label for="itemCategory">Category</label>
        <select id="itemCategory">
          <option>Checking</option><option>Savings</option><option>Brokerage</option>
          <option>401k/IRA</option><option>HSA</option><option>Home Equity</option>
          <option>Car</option><option>Other</option>
        </select>
      </div>
      <div>
        <label for="itemCountsFi">Counts toward FI?</label>
        <select id="itemCountsFi">
          <option value="yes" selected>Yes</option>
          <option value="no">No</option>
        </select>
        <small class="help">Primary home/car usually “No”.</small>
      </div>
      <div class="span-12">
        <label for="itemName">Name</label>
        <input id="itemName" type="text" placeholder="e.g., Vanguard Brokerage" />
      </div>
      <div class="span-12">
        <label for="itemAmount">Amount</label>
        <input id="itemAmount" type="number" inputmode="decimal" step="0.01" min="0" value="0" />
      </div>
      <div class="span-12" style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn" type="submit" id="saveBtn">Save item</button>
        <button class="btn secondary" type="button" id="saveAddBtn">Save & add another</button>
        <button class="btn secondary" type="button" id="cancelBtn">Cancel</button>
      </div>
    </form>
  </div>
</div>
<!-- tiny toast -->
<div id="toast">Saved</div>

<footer><p style="text-align:center;padding:1rem;">&copy; 2025 FIRE and Life.</p></footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  // ===== Utilities & Storage =====
  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=> n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
  const uid = ()=> Math.random().toString(36).slice(2,9);
  function showToast(msg='Saved'){ const t=$('toast'); t.textContent=msg; t.style.opacity='1'; setTimeout(()=> t.style.opacity='0', 1400); }

  const STORAGE_ITEMS_V2 = 'lf_nw_items_v2';
  const STORAGE_ITEMS_V1 = 'lf_nw_items_v1';
  const STORAGE_HISTORY  = 'lf_nw_history_v1';

  function migrateIfNeeded(){
    const v2 = localStorage.getItem(STORAGE_ITEMS_V2);
    if (v2) return JSON.parse(v2);
    const v1 = localStorage.getItem(STORAGE_ITEMS_V1);
    if (!v1) return [];
    let items = [];
    try { items = JSON.parse(v1) || []; } catch(e){ items = []; }
    const upgraded = items.map(it => ({
      id: it.id || uid(),
      type: it.type || 'asset',
      name: it.name || 'Item',
      amount: +it.amount || 0,
      category: 'Other',
      countsFi: true
    }));
    localStorage.setItem(STORAGE_ITEMS_V2, JSON.stringify(upgraded));
    return upgraded;
  }
  function loadItems(){ try{ return migrateIfNeeded(); } catch(e){ return []; } }
  function saveItems(items){ localStorage.setItem(STORAGE_ITEMS_V2, JSON.stringify(items)); }
  function loadHistory(){ try{ return JSON.parse(localStorage.getItem(STORAGE_HISTORY)) || []; }catch(e){ return []; } }
  function saveHistory(history){ localStorage.setItem(STORAGE_HISTORY, JSON.stringify(history)); }

  // ===== State =====
  let items = loadItems();
  let history = loadHistory();
  if (items.length && !items.some(i => 'countsFi' in i === false)) {
    items = items.map(i => ({...i, countsFi: (i.category==='Home Equity'||i.category==='Car') ? false : (i.countsFi ?? true)}));
    saveItems(items);
  }
  if (items.length === 0) {
    items = [
      { id: uid(), type:'asset', name:'Checking',    category:'Checking',  amount: 3000,  countsFi:true },
      { id: uid(), type:'asset', name:'Brokerage',   category:'Brokerage', amount: 15000, countsFi:true },
      { id: uid(), type:'asset', name:'Home Equity', category:'Home Equity', amount: 80000, countsFi:false },
      { id: uid(), type:'liability', name:'Credit Card', category:'Other', amount: 500, countsFi:false }
    ];
    saveItems(items);
  }

  // ===== DOM refs =====
  const assetsBody = $('assetsBody');
  const liabilitiesBody = $('liabilitiesBody');
  const historyBody = $('historyBody');
  const totalAssetsEl = $('totalAssets');
  const totalLiabilitiesEl = $('totalLiabilities');
  const netWorthEl = $('netWorth');
  const fiEligibleTotalEl = $('fiEligibleTotal');

  // Modal refs
  const backdrop = $('backdrop');
  const openFormFab = $('openFormFab');
  const itemForm = $('itemForm');
  const editId = $('editId'), itemType = $('itemType'), itemCategory = $('itemCategory'),
        itemCountsFi = $('itemCountsFi'), itemName = $('itemName'), itemAmount = $('itemAmount'),
        saveBtn = $('saveBtn'), cancelBtn = $('cancelBtn'), saveAddBtn = $('saveAddBtn');

  // Tabs
  document.querySelectorAll('.tabs button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      $('tab-items').hidden = tab !== 'items';
      $('tab-history').hidden = tab !== 'history';
    });
  });

  // ===== Charts =====
  const ctxMix = $('mixChart').getContext('2d');
  const ctxNW  = $('nwChart')?.getContext?.('2d');
  let chartMix, chartNW;

  function computeTotals(){
    const assets = items.filter(i=>i.type==='asset').reduce((s,i)=>s+(+i.amount||0),0);
    const liabs  = items.filter(i=>i.type==='liability').reduce((s,i)=>s+(+i.amount||0),0);
    const fiElig = items.filter(i=>i.type==='asset' && i.countsFi).reduce((s,i)=>s+(+i.amount||0),0);
    return { assets, liabs, net: assets-liabs, fiElig };
  }

  function renderSummary(){
    const { assets, liabs, net, fiElig } = computeTotals();
    totalAssetsEl.textContent = fmt(assets);
    totalLiabilitiesEl.textContent = fmt(liabs);
    netWorthEl.textContent = fmt(net);
    fiEligibleTotalEl.textContent = fmt(fiElig);
  }

  function renderLists(){
    assetsBody.innerHTML = ''; liabilitiesBody.innerHTML = '';
    items.filter(i=>i.type==='asset').forEach(addRow(assetsBody,true));
    items.filter(i=>i.type==='liability').forEach(addRow(liabilitiesBody,false));
    renderSummary(); renderMixPie();
  }

  function addRow(tbody, isAsset){
    return (i)=>{
      const tr=document.createElement('tr');
      const fiCell = isAsset ? `<td style="text-align:center">${i.countsFi ? '✅' : '—'}</td>` : `<td style="text-align:center">—</td>`;
      tr.innerHTML = `
        <td>${escapeHtml(i.name)}</td>
        <td>${escapeHtml(i.category||'Other')}</td>
        ${fiCell}
        <td style="text-align:right">${fmt(+i.amount||0)}</td>
        <td style="text-align:right" class="actions">
          <button data-act="edit" data-id="${i.id}">Edit</button>
          <button data-act="del" data-id="${i.id}">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    };
  }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[m])); }

  function renderMixPie(){
    const map = new Map(); // `${category}|${fi}`
    items.filter(i=>i.type==='asset').forEach(i=>{
      const key = (i.category||'Other') + '|' + (i.countsFi?'fi':'nfi');
      map.set(key, (map.get(key)||0) + (+i.amount||0));
    });
    const labels=[], data=[], bg=[];
    map.forEach((val,key)=>{
      const [cat,flag]=key.split('|');
      labels.push(`${cat} ${flag==='fi'?'(FI)':'(non-FI)'}`);
      data.push(val);
      bg.push(flag==='fi' ? 'rgba(26,115,232,.35)' : 'rgba(203,213,225,.7)');
    });
    if (chartMix) chartMix.destroy();
    chartMix = new Chart(ctxMix,{type:'pie',data:{labels,datasets:[{data,backgroundColor:bg}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}}});
  }

  function renderHistory(){
    if (!ctxNW) return;
    historyBody.innerHTML='';
    history.forEach(h=>{
      const tr=document.createElement('tr');
      const d=new Date(h.dateISO);
      tr.innerHTML = `<td>${d.toLocaleDateString(undefined,{year:'numeric',month:'short'})}</td><td style="text-align:right">${fmt(h.netWorthNumber)}</td>`;
      historyBody.appendChild(tr);
    });
    const labels = history.map(h=> new Date(h.dateISO).toLocaleDateString(undefined,{year:'2-digit',month:'short'}));
    const data   = history.map(h=> h.netWorthNumber);
    if (chartNW) chartNW.destroy();
    chartNW = new Chart(ctxNW,{type:'line',data:{labels,datasets:[{label:'Net worth',data, borderWidth:2, fill:false, tension:.15, pointRadius:2}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{ticks:{callback:v=>fmt(v)}}}});
  }

  // ===== Modal logic (autofocus & defaults) =====
  function openModal(editItem=null){
    backdrop.style.display='flex'; backdrop.setAttribute('aria-hidden','false');
    if (editItem){
      $('modalTitle').textContent='Edit Item';
      editId.value = editItem.id;
      itemType.value = editItem.type;
      itemCategory.value = editItem.category || 'Other';
      itemCountsFi.value = editItem.countsFi ? 'yes' : 'no';
      itemName.value = editItem.name || '';
      itemAmount.value = (editItem.amount ?? 0);
      saveBtn.textContent='Update item';
    } else {
      $('modalTitle').textContent='Add Item';
      editId.value=''; itemType.value='asset'; itemCategory.value='Checking';
      itemCountsFi.value='yes'; itemName.value=''; itemAmount.value='0';
      saveBtn.textContent='Save item';
    }
    setTimeout(()=> itemName.focus(), 50);
  }
  function closeModal(){ backdrop.style.display='none'; backdrop.setAttribute('aria-hidden','true'); }

  // Open/close bindings (no duplicate declarations)
  openFormFab.addEventListener('click', ()=> openModal());
  cancelBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=> { if (e.target===backdrop) closeModal(); });
  document.addEventListener('keydown', (e)=> { if (e.key === 'Escape') closeModal(); });

  // Table actions → open modal prefilled / delete
  function onTableClick(e){
    const btn = e.target.closest('button[data-act]');
    if (!btn) return;
    const id  = btn.getAttribute('data-id');
    const act = btn.getAttribute('data-act');
    const it  = items.find(x=>x.id===id);
    if (!it) return;
    if (act==='edit'){ openModal(it); }
    if (act==='del'){ items = items.filter(x=>x.id!==id); saveItems(items); renderLists(); }
  }
  assetsBody.addEventListener('click', onTableClick);
  liabilitiesBody.addEventListener('click', onTableClick);

  // Save helpers
  function persistEntry(id){
    const entry = {
      id: id || uid(),
      type: itemType.value,
      category: itemCategory.value || 'Other',
      name: (itemName.value || '').trim() || (itemType.value==='asset'?'Asset':'Liability'),
      amount: parseFloat(itemAmount.value || '0') || 0,
      countsFi: (itemType.value==='asset') ? (itemCountsFi.value==='yes') : false
    };
    if (id){ items = items.map(it => it.id===id ? entry : it); }
    else { items.push(entry); }
    saveItems(items);
    renderLists();
  }

  // Form submit
  itemForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const id = editId.value.trim();
    persistEntry(id);
    showToast(id ? 'Updated' : 'Item added');
    closeModal();
  });
  saveAddBtn.addEventListener('click', ()=>{
    const id = editId.value.trim();
    persistEntry(id);
    showToast('Item added');
    editId.value=''; itemName.value=''; itemAmount.value='0'; saveBtn.textContent='Save item';
    setTimeout(()=> itemName.focus(), 50);
  });

  // ===== History actions =====
  $('snapshotBtn').addEventListener('click', ()=>{
    const { net } = computeTotals();
    const now=new Date();
    const monthKey = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();
    const idx = history.findIndex(h=>h.dateISO===monthKey);
    const entry = { dateISO: monthKey, netWorthNumber: net };
    if (idx>=0) history[idx]=entry; else history.push(entry);
    history.sort((a,b)=> new Date(a.dateISO)-new Date(b.dateISO));
    saveHistory(history); renderHistory();
  });

  $('exportCsvBtn').addEventListener('click', ()=>{
    const rows=[['Date','Net Worth']];
    history.forEach(h=> rows.push([ new Date(h.dateISO).toISOString().slice(0,10), h.netWorthNumber ]));
    const csv=rows.map(r=>r.join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='net-worth-history.csv'; a.click(); URL.revokeObjectURL(url);
  });

  // ===== Initial render =====
  renderLists(); renderHistory();
})();
</script>
</body>
</html>