<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Early Retirement Estimator • FIREandLife</title>
  <link rel="stylesheet" href="/styles.css?v=20250811c" />
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KHKJVXPJQM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KHKJVXPJQM');
  </script>
  <!-- End Google Analytics -->
  <style>
    /* small helpers for a clean default look; adjust in your CSS as needed */
    .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
    .grid { display: grid; gap: 1rem; }
    .grid-12 { grid-template-columns: repeat(12, 1fr); }
    .span-12 { grid-column: span 12; } .span-6 { grid-column: span 6; }
    .span-4 { grid-column: span 4; } .span-3 { grid-column: span 3; }
    .card { background: #fff; border: 1px solid #e9edf2; border-radius: .5rem; padding: 1rem; }
    .soft { background:#f7fafc; border:1px solid #e9edf2; border-radius:.5rem; padding:1rem; }
    label { display:block; font-weight:600; margin-bottom:.25rem; }
    input, select, button { width:100%; padding:.55rem .65rem; border:1px solid #cfd8e3; border-radius:.35rem; }
    button { cursor:pointer; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding:.5rem; border-bottom:1px solid #eef2f7; }
    .sr-only { position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }
    .muted { font-size:.9rem; opacity:.8; }
    .row { display:flex; gap:.5rem; flex-wrap:wrap; }
    .badge { display:inline-block; padding:.2rem .5rem; border:1px solid #e2e8f0; border-radius:999px; font-size:.8rem; }
  </style>
</head>
<body>
<header>
  <nav style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
    <div class="logo"><img src="/assets/logo-horizontal.png" alt="FIREandLife" style="height:40px;"></div>
    <ul class="nav-links" style="list-style:none;display:flex;gap:1.5rem;margin:0;">
      <li><a href="/">Home</a></li>
      <li><a href="/calculators/" aria-current="page">Calculators</a></li>
      <li><a href="/blog/">Blog</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/contact/">Contact</a></li>
    </ul>
  </nav>
</header>

<main class="container">
  <h1>Early Retirement Estimator</h1>

  <section id="ere" aria-labelledby="ere-title">
    <p id="ere-title" class="sr-only">Early Retirement Estimator</p>

    <!-- Inputs -->
    <form id="ere-form" class="grid grid-12" style="align-items:end">
      <div class="span-3">
        <label for="currentBalance">Current portfolio balance</label>
        <input id="currentBalance" type="number" min="0" step="100" value="50000" inputmode="decimal" />
      </div>

      <div class="span-3">
        <label for="contributionMonthly">Monthly contribution</label>
        <input id="contributionMonthly" type="number" min="0" step="50" value="1000" inputmode="decimal" />
      </div>

      <div class="span-3">
        <label for="contributionBump">Add’l monthly contribution (optional)</label>
        <input id="contributionBump" type="number" min="0" step="50" value="0" inputmode="decimal" />
      </div>
      <div class="span-3">
        <label for="bumpYear">Bump starts after year</label>
        <input id="bumpYear" type="number" min="0" step="1" value="5" />
      </div>

      <div class="span-3">
        <label for="returnPct">Expected annual return (%)</label>
        <input id="returnPct" type="number" step="0.1" value="6.0" />
      </div>
      <div class="span-3">
        <label for="inflationPct">Inflation (%)</label>
        <input id="inflationPct" type="number" step="0.1" value="2.0" />
      </div>
      <div class="span-3">
        <label for="useReal">Show values</label>
        <select id="useReal" aria-describedby="useRealDesc">
          <option value="real" selected>Inflation-adjusted (real)</option>
          <option value="nominal">Nominal</option>
        </select>
        <small id="useRealDesc" class="muted">Real values show purchasing power.</small>
      </div>

      <div class="span-3">
        <label for="annualSpend">Target annual spending (retirement)</label>
        <input id="annualSpend" type="number" min="0" step="100" value="60000" inputmode="decimal" />
      </div>
      <div class="span-3">
        <label for="withdrawalRate">Withdrawal rate (%)</label>
        <input id="withdrawalRate" type="number" step="0.1" value="4.0" />
      </div>

      <div class="span-3">
        <label for="maxYears">Max years to simulate</label>
        <input id="maxYears" type="number" min="1" max="70" step="1" value="50" />
      </div>
      <div class="span-3">
        <label for="currentAge">Your current age (optional)</label>
        <input id="currentAge" type="number" min="0" max="100" step="1" value="35" />
      </div>

      <div class="span-12 row">
        <button type="button" id="runBtn">Update results</button>
        <button type="button" id="downloadCsvBtn">Download CSV</button>
        <label class="badge" style="align-self:center;">
          <input id="compare200" type="checkbox" style="margin-right:.4rem" />
          Compare “+ $200/mo”
        </label>
      </div>
    </form>

    <!-- Summary -->
    <section aria-live="polite" class="grid grid-12" style="margin-top:1rem">
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">FI Number</h3>
        <div><strong id="fiNumber">$0</strong></div>
        <small class="muted">Spending ÷ withdrawal rate</small>
      </div>
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">Estimated FI date</h3>
        <div><strong id="fiDate">—</strong> (<span id="fiYears">—</span> years)</div>
        <small id="fiAgeNote" class="muted"></small>
      </div>
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">Milestones</h3>
        <div>Half-FI: <strong id="halfFiDate">—</strong></div>
        <div>Coast-FI: <strong id="coastFiDate">—</strong></div>
      </div>
    </section>

    <!-- Insight box -->
    <div class="card" id="insightBox" style="margin-top:1rem; display:none;">
      <strong>What speeds this up?</strong>
      <p id="insightText" class="muted" style="margin:.35rem 0 0 0;"></p>
    </div>

    <!-- Chart -->
    <div class="card" style="margin-top:1rem;">
      <canvas id="fiChart" height="160" aria-label="Net worth growth to FI line chart" role="img"></canvas>
    </div>

    <!-- Table -->
    <div style="margin-top:1rem;overflow:auto">
      <table id="fiTable">
        <thead>
          <tr>
            <th style="text-align:left">Year</th>
            <th style="text-align:right">End Balance</th>
            <th style="text-align:right">Total Contribs</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Newsletter CTA (optional wire-up to Mailchimp/Netlify Forms) -->
    <div class="soft" style="margin-top:1rem;">
      <div class="row" style="align-items:center; justify-content:space-between;">
        <div>
          <strong>Get your plan by email</strong>
          <div class="muted">Tips to reach FI sooner + new tools.</div>
        </div>
        <form id="ctaForm" class="row" onsubmit="event.preventDefault(); alert('Wire this to Mailchimp/Netlify Forms.');">
          <input type="email" id="ctaEmail" placeholder="you@example.com" required style="min-width:260px;">
          <button type="submit">Send my plan</button>
        </form>
      </div>
    </div>

    <!-- Helper text -->
    <details style="margin-top:1rem">
      <summary>How this estimate works</summary>
      <p style="margin-top:.5rem">
        We project monthly compounding and monthly contributions. Your <em>FI Number</em> equals
        annual spending divided by your chosen withdrawal rate. “Real” values remove inflation
        so year-to-year amounts are comparable in purchasing power. “Coast-FI” is the date your
        portfolio could coast (no new contributions) and still reach FI by the end of the horizon
        at your selected real growth rate.
      </p>
    </details>
  </section>
</main>

<footer><p style="text-align:center;padding:1rem;">&copy; 2025 FIRE and Life.</p></footer>

<!-- Charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const fmt = (n) => n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
  const mRate = (annualPct) => Math.pow(1 + (annualPct/100), 1/12) - 1;

  function simulate({ startBal, contribMonthly, contribBump, bumpYear, retPct, inflPct, useReal, spend, wrPct, maxYears }) {
    const months = Math.max(12, Math.min(70*12, Math.floor(maxYears*12)));
    const rNom = mRate(retPct);
    const rInfl = mRate(inflPct);
    const rReal = ((1 + rNom) / (1 + rInfl)) - 1;
    const r = (useReal === 'real') ? rReal : rNom;

    const bal = new Array(months+1).fill(0);
    const totalContrib = new Array(months+1).fill(0);
    bal[0] = startBal;

    const FI = spend / (wrPct/100);
    const bumpMonth = Math.max(0, Math.floor(bumpYear*12));

    for (let m = 1; m <= months; m++) {
      const thisContrib = contribMonthly + (m >= bumpMonth ? contribBump : 0);
      totalContrib[m] = totalContrib[m-1] + thisContrib;
      bal[m] = bal[m-1] * (1 + r) + thisContrib;
    }

    const halfFI = FI / 2;
    const findCross = (target) => {
      for (let m=0; m<=months; m++) if (bal[m] >= target) return m;
      return null;
    };

    const fiMonth = findCross(FI);
    const halfFiMonth = findCross(halfFI);

    // Coast-FI (simple): earliest month where compounding alone reaches FI by end
    let coastMonth = null;
    for (let m = 0; m <= months; m++) {
      const remain = months - m;
      const future = bal[m] * Math.pow(1 + r, remain);
      if (future >= FI) { coastMonth = m; break; }
    }

    return { bal, totalContrib, months, r, FI, fiMonth, halfFiMonth, coastMonth };
  }

  const inputs = {
    currentBalance: $('currentBalance'),
    contributionMonthly: $('contributionMonthly'),
    contributionBump: $('contributionBump'),
    bumpYear: $('bumpYear'),
    returnPct: $('returnPct'),
    inflationPct: $('inflationPct'),
    useReal: $('useReal'),
    annualSpend: $('annualSpend'),
    withdrawalRate: $('withdrawalRate'),
    maxYears: $('maxYears'),
    currentAge: $('currentAge'),
    compare200: $('compare200'),
  };

  const fiNumberEl = $('fiNumber');
  const fiDateEl = $('fiDate');
  const fiYearsEl = $('fiYears');
  const fiAgeNoteEl = $('fiAgeNote');
  const halfFiDateEl = $('halfFiDate');
  const coastFiDateEl = $('coastFiDate');
  const tableBody = $('fiTable').querySelector('tbody');
  const runBtn = $('runBtn');
  const dlBtn = $('downloadCsvBtn');
  const insightBox = $('insightBox');
  const insightText = $('insightText');

  const ctx = $('fiChart').getContext('2d');
  let chart;

  function renderChart(labels, baseBalances, FI, compBalances=null) {
    const datasets = [
      { label: 'Portfolio balance', data: baseBalances, borderWidth: 2, fill: false, tension: 0.15, pointRadius: 0 },
      { label: 'FI target', data: baseBalances.map(() => FI), borderWidth: 1, borderDash: [6,6], fill: false, pointRadius: 0 }
    ];
    if (Array.isArray(compBalances)) {
      datasets.push({ label: 'Balance (+$200/mo)', data: compBalances, borderWidth: 2, fill: false, tension: 0.15, pointRadius: 0 });
    }
    const data = { labels, datasets };

    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'line',
      data,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: { display: true },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                const label = ctx.dataset.label || '';
                return `${label}: ${fmt(ctx.raw)}`;
              }
            }
          }
        },
        scales: {
          x: { title: { display: true, text: 'Year' } },
          y: { title: { display: true, text: 'Balance' }, ticks: { callback: v => fmt(v) } }
        }
      }
    });
  }

  function ymdPlusMonths(d, months) { const dt = new Date(d.getTime()); dt.setMonth(dt.getMonth()+months); return dt; }

  function run() {
    const now = new Date();

    const startBal = +inputs.currentBalance.value || 0;
    const contribMonthly = +inputs.contributionMonthly.value || 0;
    const contribBump = +inputs.contributionBump.value || 0;
    const bumpYear = +inputs.bumpYear.value || 0;

    const retPct = +inputs.returnPct.value || 0;
    const inflPct = +inputs.inflationPct.value || 0;
    const useReal = inputs.useReal.value;

    const spend = +inputs.annualSpend.value || 0;
    const wrPct = +inputs.withdrawalRate.value || 4.0;
    const maxYears = +inputs.maxYears.value || 50;
    const currentAge = +inputs.currentAge.value || null;

    // Baseline sim
    const res = simulate({ startBal, contribMonthly, contribBump, bumpYear, retPct, inflPct, useReal, spend, wrPct, maxYears });

    // Comparison sim (+$200/mo)
    const doCompare = inputs.compare200.checked;
    let resComp = null;
    if (doCompare) {
      resComp = simulate({ startBal, contribMonthly: contribMonthly+200, contribBump, bumpYear, retPct, inflPct, useReal, spend, wrPct, maxYears });
    }

    // Summary numbers
    fiNumberEl.textContent = fmt(res.FI);
    let fiDateText = 'Not reached in horizon', fiYearsText = '—', ageNote = '';
    if (res.fiMonth !== null) {
      const fiDate = ymdPlusMonths(now, res.fiMonth);
      fiDateText = fiDate.toLocaleDateString(undefined, { year:'numeric', month:'short' });
      fiYearsText = (res.fiMonth/12).toFixed(1);
      if (!Number.isNaN(currentAge)) ageNote = `Age at FI ≈ ${(currentAge + res.fiMonth/12).toFixed(1)}`;
    }
    fiDateEl.textContent = fiDateText;
    fiYearsEl.textContent = fiYearsText;
    fiAgeNoteEl.textContent = ageNote;

    const fmtMilestone = (m) => m===null ? '—' : ymdPlusMonths(now, m).toLocaleDateString(undefined, { year:'numeric', month:'short' });
    halfFiDateEl.textContent = fmtMilestone(res.halfFiMonth);
    coastFiDateEl.textContent = fmtMilestone(res.coastMonth);

    // Table (annual)
    tableBody.innerHTML = '';
    const labels = [];
    const yearEndBalances = [];
    const yearEndBalancesComp = [];
    for (let y=1; y<=Math.ceil(res.months/12); y++) {
      const idx = Math.min(y*12, res.months);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${now.getFullYear()+y}</td>
        <td style="text-align:right">${fmt(res.bal[idx])}</td>
        <td style="text-align:right">${fmt(res.totalContrib[idx])}</td>
      `;
      tableBody.appendChild(tr);
      labels.push(now.getFullYear()+y);
      yearEndBalances.push(res.bal[idx]);
      if (resComp) yearEndBalancesComp.push(resComp.bal[idx]);
    }

    // Chart
    renderChart(labels, yearEndBalances, res.FI, resComp ? yearEndBalancesComp : null);

    // Insight box (“what speeds this up?”)
    if (resComp && res.fiMonth !== null && resComp.fiMonth !== null) {
      const deltaMonths = res.fiMonth - resComp.fiMonth;
      if (deltaMonths > 0) {
        insightBox.style.display = 'block';
        const yrs = (deltaMonths/12).toFixed(1);
        insightText.textContent = `Adding $200/month could bring FI forward by about ${yrs} years (from ${fiDateEl.textContent} to ${ymdPlusMonths(now, resComp.fiMonth).toLocaleDateString(undefined,{year:'numeric',month:'short'})}).`;
      } else {
        insightBox.style.display = 'none';
      }
    } else {
      insightBox.style.display = 'none';
    }
  }

  document.querySelectorAll('#ere-form input, #ere-form select').forEach(el => {
    el.addEventListener('input', run);
    el.addEventListener('change', run);
  });
  $('runBtn').addEventListener('click', run);

  // CSV export (from current table)
  $('downloadCsvBtn').addEventListener('click', () => {
    const rows = [['Year','End Balance','Total Contributions']];
    document.querySelectorAll('#fiTable tbody tr').forEach(tr => {
      const tds = tr.querySelectorAll('td');
      const clean = (s) => s.replace(/[^0-9\.-]/g,'');
      rows.push([tds[0].textContent, clean(tds[1].textContent), clean(tds[2].textContent)]);
    });
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'early-retirement-estimator.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  // initial render
  run();
})();
</script>
</body>
</html>
