<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Early Retirement Estimator • FIREandLife</title>
  <link rel="stylesheet" href="/styles.css?v=20250811c" />
  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KHKJVXPJQM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config','G-KHKJVXPJQM');
  </script>
  <style>
    :root{
      --bg:#ffffff; --soft:#f7fafc; --border:#e9edf2; --ink:#0f172a; --muted:#475569;
      --accent:#ff6b5d; --accent-ink:#fff;
    }
    body{background:var(--bg); color:var(--ink);}
    .container{max-width:1100px;margin:2rem auto;padding:0 1rem;}
    h1{margin-bottom:.75rem}
    .lead{color:var(--muted); margin:.25rem 0 1rem}
    .grid{display:grid; gap:1rem}
    .grid-12{grid-template-columns:repeat(12,1fr)}
    .span-12{grid-column:span 12} .span-6{grid-column:span 6} .span-4{grid-column:span 4} .span-3{grid-column:span 3}
    .card{background:#fff;border:1px solid var(--border);border-radius:.6rem;padding:1rem}
    .soft{background:var(--soft);border:1px solid var(--border);border-radius:.6rem;padding:1rem}
    label{display:block;font-weight:600;margin-bottom:.25rem}
    input,select,button{width:100%;padding:.7rem .75rem;border:1px solid #cfd8e3;border-radius:.4rem;font-size:16px}
    input,select{background:#fff}
    small.help{display:block;color:var(--muted);margin-top:.25rem;font-size:.85rem;line-height:1.3}
    button{cursor:pointer}
    .row{display:flex;gap:.5rem;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:.4rem;border:1px solid #e2e8f0;border-radius:999px;padding:.25rem .55rem;font-size:.85rem}
    .btn{background:var(--accent);color:var(--accent-ink);border:none}
    .btn.secondary{background:#fff;color:#111;border:1px solid #cbd5e1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.6rem;border-bottom:1px solid #eef2f7}
    .muted{color:var(--muted)}
    /* Mobile tweaks */
    @media (max-width: 680px){
      .grid-12{grid-template-columns:repeat(6,1fr)}
      .span-3,.span-4,.span-6,.span-12{grid-column:1 / -1}
      .row > *{flex:1 1 100%}
      .btn, .badge{width:100%}
    }
    /* Modal (newsletter soft-gate) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:1rem;z-index:50}
    .modal{background:#fff;border-radius:.7rem;max-width:520px;width:100%;padding:1rem;border:1px solid var(--border)}
    .modal h3{margin:.25rem 0}
  </style>
</head>
<body>
<header>
  <nav style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.06);">
    <div class="logo"><img src="/assets/logo-horizontal.png" alt="FIREandLife" style="height:40px;"></div>
    <ul class="nav-links" style="list-style:none;display:flex;gap:1.2rem;margin:0;">
      <li><a href="/">Home</a></li>
      <li><a href="/calculators/" aria-current="page">Calculators</a></li>
      <li><a href="/blog/">Blog</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/contact/">Contact</a></li>
    </ul>
  </nav>
</header>

<main class="container">
  <h1>Early Retirement Estimator</h1>
  <p class="lead">Estimate when you’ll reach <strong>FI</strong> (financial independence), see the <strong>FI number</strong>, and how faster contributions shift your timeline. Choose “Real” values to view results in today’s purchasing power.</p>

  <section id="ere">
    <!-- INPUTS -->
    <form id="ere-form" class="grid grid-12" style="align-items:end">
      <div class="span-3">
        <label for="currentBalance">Current portfolio balance</label>
        <input id="currentBalance" type="number" value="50000" min="0" step="100" inputmode="decimal" aria-describedby="hb1"/>
        <small id="hb1" class="help">Total invested today across accounts.</small>
      </div>

      <div class="span-3">
        <label for="contributionMonthly">Monthly contribution</label>
        <input id="contributionMonthly" type="number" value="1000" min="0" step="50" inputmode="decimal" aria-describedby="hb2"/>
        <small id="hb2" class="help">Average monthly deposits (401k, IRA, brokerage, etc.).</small>
      </div>

      <div class="span-3">
        <label for="contributionBump">Add’l monthly contribution (optional)</label>
        <input id="contributionBump" type="number" value="0" min="0" step="50" inputmode="decimal" aria-describedby="hb3"/>
        <small id="hb3" class="help">Extra amount you’ll add later (e.g., after childcare/mortgage ends).</small>
      </div>

      <div class="span-3">
        <label for="bumpYear">Bump starts after year</label>
        <input id="bumpYear" type="number" value="5" min="0" step="1" aria-describedby="hb4"/>
        <small id="hb4" class="help">When that extra contribution begins.</small>
      </div>

      <div class="span-3">
        <label for="returnPct">Expected annual return (%)</label>
        <input id="returnPct" type="number" value="6.0" step="0.1" aria-describedby="hb5"/>
        <small id="hb5" class="help">Long-term average (before inflation) if viewing “Nominal.”</small>
      </div>

      <div class="span-3">
        <label for="inflationPct">Inflation (%)</label>
        <input id="inflationPct" type="number" value="2.0" step="0.1" aria-describedby="hb6"/>
        <small id="hb6" class="help">Used to show “Real” results in today’s dollars.</small>
      </div>

      <div class="span-3">
        <label for="useReal">Show values</label>
        <select id="useReal" aria-describedby="hb7">
          <option value="real" selected>Inflation-adjusted (real)</option>
          <option value="nominal">Nominal</option>
        </select>
        <small id="hb7" class="help">Real = easier to compare over time; Nominal = raw dollars.</small>
      </div>

      <div class="span-3">
        <label for="annualSpend">Target annual spending (retirement)</label>
        <input id="annualSpend" type="number" value="60000" min="0" step="100" inputmode="decimal" aria-describedby="hb8"/>
        <small id="hb8" class="help">How much you plan to spend per year in retirement (today’s $ if Real).</small>
      </div>

      <div class="span-3">
        <label for="withdrawalRate">Withdrawal rate (%)</label>
        <input id="withdrawalRate" type="number" value="4.0" step="0.1" aria-describedby="hb9"/>
        <small id="hb9" class="help">Common choices: 4.0, 3.5, or 3.0 depending on risk tolerance.</small>
      </div>

      <div class="span-3">
        <label for="maxYears">Max years to simulate</label>
        <input id="maxYears" type="number" value="50" min="1" max="70" step="1" aria-describedby="hb10"/>
        <small id="hb10" class="help">We’ll stop early if you hit FI first.</small>
      </div>

      <div class="span-3">
        <label for="currentAge">Your current age (optional)</label>
        <input id="currentAge" type="number" value="35" min="0" max="100" step="1" aria-describedby="hb11"/>
        <small id="hb11" class="help">We’ll estimate your age at FI.</small>
      </div>

      <div class="span-12 row">
        <button type="button" id="runBtn" class="btn">Update results</button>
        <button type="button" id="downloadCsvBtn" class="btn secondary">Download CSV</button>
        <label class="badge"><input id="compare200" type="checkbox" /> Compare “+ $200/mo”</label>
      </div>
    </form>

    <!-- OUTPUTS -->
    <section aria-live="polite" class="grid grid-12" style="margin-top:1rem">
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">FI Number</h3>
        <div><strong id="fiNumber">$0</strong></div>
        <small class="muted">FI = annual spending ÷ withdrawal rate.</small>
      </div>
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">Estimated FI date</h3>
        <div><strong id="fiDate">—</strong> (<span id="fiYears">—</span> years)</div>
        <small id="fiAgeNote" class="muted"></small>
      </div>
      <div class="span-4 soft">
        <h3 style="margin:.25rem 0">Milestones</h3>
        <div>Half-FI: <strong id="halfFiDate">—</strong></div>
        <div>Coast-FI: <strong id="coastFiDate">—</strong></div>
      </div>
    </section>

    <!-- Insight -->
    <div class="card" id="insightBox" style="margin-top:1rem; display:none;">
      <strong>What speeds this up?</strong>
      <p id="insightText" class="muted" style="margin:.35rem 0 0 0;"></p>
    </div>

    <!-- Chart -->
    <div class="card" style="margin-top:1rem">
      <canvas id="fiChart" height="170" aria-label="Net worth growth to FI line chart" role="img"></canvas>
    </div>

    <!-- Table -->
    <div style="margin-top:1rem;overflow:auto">
      <table id="fiTable">
        <thead>
          <tr><th style="text-align:left">Year</th><th style="text-align:right">End Balance</th><th style="text-align:right">Total Contribs</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- How to read outputs -->
    <details class="soft" style="margin-top:1rem">
      <summary><strong>How to read the outputs</strong></summary>
      <ul style="margin:.75rem 0 0 1rem;line-height:1.55">
        <li><strong>FI Number</strong> is your target nest egg to fund spending at your chosen withdrawal rate.</li>
        <li><strong>Real vs Nominal</strong>: Real shows everything in today’s dollars (removes inflation).</li>
        <li><strong>Half-FI</strong> ≈ halfway to the target; <strong>Coast-FI</strong> ≈ when compounding alone can carry you to FI.</li>
        <li>Use <strong>“+ $200/mo”</strong> to see how small increases accelerate your FI date.</li>
      </ul>
    </details>
  </section>
</main>

<footer><p style="text-align:center;padding:1rem;">&copy; 2025 FIRE and Life.</p></footer>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Newsletter soft-gate modal -->
<div class="modal-backdrop" id="nlBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="nlTitle">
    <h3 id="nlTitle">Get the CSV + weekly FI tips</h3>
    <p class="muted" style="margin:.25rem 0 1rem">Enter your email to receive the download and our best calculators & guides (1–2 emails/week). Unsubscribe anytime.</p>
    <!-- Replace the form below with your Mailchimp embed ACTION & hidden fields if you wish -->
    <form id="nlForm" class="grid" style="grid-template-columns:1fr auto; gap:.5rem">
      <input id="nlEmail" type="email" placeholder="you@example.com" required />
      <button class="btn" type="submit">Send the CSV</button>
      <small class="muted span-12">We’ll store a cookie so you won’t be asked again on this device.</small>
    </form>
    <div class="row" style="margin-top:.75rem;justify-content:space-between">
      <button class="btn secondary" id="nlCloseBtn" type="button">Maybe later</button>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=> n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
  const mRate = (a)=> Math.pow(1 + (a/100), 1/12) - 1;

  function simulate({startBal,contribMonthly,contribBump,bumpYear,retPct,inflPct,useReal,spend,wrPct,maxYears}){
    const months = Math.max(12, Math.min(70*12, Math.floor(maxYears*12)));
    const rNom = mRate(retPct), rInfl = mRate(inflPct);
    const rReal = ((1+rNom)/(1+rInfl))-1;
    const r = (useReal==='real') ? rReal : rNom;

    const bal = Array(months+1).fill(0);
    const totalContrib = Array(months+1).fill(0);
    bal[0]=startBal;

    const FI = spend/(wrPct/100);
    const bumpMonth = Math.max(0, Math.floor(bumpYear*12));

    for(let m=1;m<=months;m++){
      const add = contribMonthly + (m>=bumpMonth ? contribBump : 0);
      totalContrib[m]=totalContrib[m-1]+add;
      bal[m]=bal[m-1]*(1+r)+add;
    }

    const halfFI = FI/2;
    const cross = (target)=>{ for(let m=0;m<=months;m++){ if(bal[m]>=target) return m; } return null; };
    const fiMonth = cross(FI), halfFiMonth = cross(halfFI);

    // Coast-FI (simple)
    let coastMonth=null;
    for(let m=0;m<=months;m++){
      const remain=months-m;
      const future=bal[m]*Math.pow(1+r,remain);
      if(future>=FI){coastMonth=m;break;}
    }

    return {bal,totalContrib,months,FI,fiMonth,halfFiMonth,coastMonth};
  }

  // inputs
  const inputs={
    currentBalance:$('currentBalance'),
    contributionMonthly:$('contributionMonthly'),
    contributionBump:$('contributionBump'),
    bumpYear:$('bumpYear'),
    returnPct:$('returnPct'),
    inflationPct:$('inflationPct'),
    useReal:$('useReal'),
    annualSpend:$('annualSpend'),
    withdrawalRate:$('withdrawalRate'),
    maxYears:$('maxYears'),
    currentAge:$('currentAge'),
    compare200:$('compare200'),
  };

  // outputs
  const fiNumberEl=$('fiNumber'), fiDateEl=$('fiDate'), fiYearsEl=$('fiYears'), fiAgeNoteEl=$('fiAgeNote');
  const halfFiDateEl=$('halfFiDate'), coastFiDateEl=$('coastFiDate'), tableBody=document.querySelector('#fiTable tbody');
  const insightBox=$('insightBox'), insightText=$('insightText');

  // chart
  const ctx=$('fiChart').getContext('2d'); let chart;
  function renderChart(labels, base, FI, comp=null){
    const datasets=[
      {label:'Portfolio balance', data:base, borderWidth:2, fill:false, tension:.15, pointRadius:0},
      {label:'FI target', data:base.map(()=>FI), borderWidth:1, borderDash:[6,6], fill:false, pointRadius:0}
    ];
    if (Array.isArray(comp)){ datasets.push({label:'Balance (+$200/mo)', data:comp, borderWidth:2, fill:false, tension:.15, pointRadius:0}); }
    if (chart) chart.destroy();
    chart=new Chart(ctx,{type:'line',data:{labels,datasets},options:{
      responsive:true, maintainAspectRatio:false,
      interaction:{mode:'index', intersect:false},
      plugins:{legend:{display:true}, tooltip:{callbacks:{label:(c)=>`${c.dataset.label}: ${fmt(c.raw)}`}}},
      scales:{x:{title:{display:true,text:'Year'}}, y:{title:{display:true,text:'Balance'}, ticks:{callback:v=>fmt(v)}}}
    }});
  }

  function ymdPlusMonths(d,m){const dt=new Date(d.getTime()); dt.setMonth(dt.getMonth()+m); return dt;}

  function run(){
    const now=new Date();

    const startBal=+inputs.currentBalance.value||0;
    const contribMonthly=+inputs.contributionMonthly.value||0;
    const contribBump=+inputs.contributionBump.value||0;
    const bumpYear=+inputs.bumpYear.value||0;
    const retPct=+inputs.returnPct.value||0;
    const inflPct=+inputs.inflationPct.value||0;
    const useReal=inputs.useReal.value;
    const spend=+inputs.annualSpend.value||0;
    const wrPct=+inputs.withdrawalRate.value||4.0;
    const maxYears=+inputs.maxYears.value||50;
    const currentAge=+inputs.currentAge.value||null;

    const base=simulate({startBal,contribMonthly,contribBump,bumpYear,retPct,inflPct,useReal,spend,wrPct,maxYears});
    const doComp=inputs.compare200.checked;
    const comp= doComp ? simulate({startBal,contribMonthly:contribMonthly+200,contribBump,bumpYear,retPct,inflPct,useReal,spend,wrPct,maxYears}) : null;

    // outputs
    fiNumberEl.textContent=fmt(base.FI);
    let fiText='Not reached in horizon', fiYears='—', ageNote='';
    if (base.fiMonth!==null){
      const d=ymdPlusMonths(now, base.fiMonth);
      fiText=d.toLocaleDateString(undefined,{year:'numeric',month:'short'});
      fiYears=(base.fiMonth/12).toFixed(1);
      if (!Number.isNaN(currentAge)) ageNote=`Age at FI ≈ ${(currentAge + base.fiMonth/12).toFixed(1)}`;
    }
    fiDateEl.textContent=fiText; fiYearsEl.textContent=fiYears; fiAgeNoteEl.textContent=ageNote;
    const fmtMil=(m)=> m===null?'—': ymdPlusMonths(now,m).toLocaleDateString(undefined,{year:'numeric',month:'short'});
    halfFiDateEl.textContent=fmtMil(base.halfFiMonth); coastFiDateEl.textContent=fmtMil(base.coastMonth);

    // table & labels
    tableBody.innerHTML=''; const labels=[], yearEnd=[], yearEndComp=[];
    for(let y=1;y<=Math.ceil(base.months/12);y++){
      const idx=Math.min(y*12, base.months);
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${now.getFullYear()+y}</td><td style="text-align:right">${fmt(base.bal[idx])}</td><td style="text-align:right">${fmt(base.totalContrib[idx])}</td>`;
      tableBody.appendChild(tr);
      labels.push(now.getFullYear()+y);
      yearEnd.push(base.bal[idx]);
      if (comp) yearEndComp.push(comp.bal[idx]);
    }

    renderChart(labels, yearEnd, base.FI, comp?yearEndComp:null);

    // insight
    if (comp && base.fiMonth!==null && comp.fiMonth!==null){
      const delta=base.fiMonth-comp.fiMonth;
      if (delta>0){
        insightBox.style.display='block';
        const yrs=(delta/12).toFixed(1);
        insightText.textContent=`Adding $200/month could bring FI forward by about ${yrs} years (from ${fiDateEl.textContent} to ${ymdPlusMonths(now, comp.fiMonth).toLocaleDateString(undefined,{year:'numeric',month:'short'})}).`;
      } else { insightBox.style.display='none'; }
    } else { insightBox.style.display='none'; }
  }

  // bind
  document.querySelectorAll('#ere-form input, #ere-form select').forEach(el=>{
    el.addEventListener('input', run); el.addEventListener('change', run);
  });
  $('runBtn').addEventListener('click', run);

  // CSV (soft-gate)
  const subscribed = ()=> localStorage.getItem('lf_subscribed')==='true';
  const openNL = ()=> { const b=$('nlBackdrop'); b.style.display='flex'; b.setAttribute('aria-hidden','false'); };
  const closeNL = ()=> { const b=$('nlBackdrop'); b.style.display='none'; b.setAttribute('aria-hidden','true'); };

  $('downloadCsvBtn').addEventListener('click', ()=>{
    if (!subscribed()) { openNL(); return; }
    downloadCsv();
  });

  $('nlCloseBtn').addEventListener('click', closeNL);

  // Replace with your Mailchimp form integration if desired:
  $('nlForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    // TODO: swap for real subscribe call or embed
    const email=$('nlEmail').value.trim();
    if (!email) return;
    localStorage.setItem('lf_subscribed','true');
    closeNL();
    setTimeout(downloadCsv, 250);
  });

  function downloadCsv(){
    const rows=[['Year','End Balance','Total Contributions']];
    document.querySelectorAll('#fiTable tbody tr').forEach(tr=>{
      const tds=tr.querySelectorAll('td'); const clean=s=>s.replace(/[^0-9\.-]/g,'');
      rows.push([tds[0].textContent, clean(tds[1].textContent), clean(tds[2].textContent)]);
    });
    const csv=rows.map(r=>r.join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='early-retirement-estimator.csv'; a.click(); URL.revokeObjectURL(url);
  }

  // first render
  run();
})();
</script>
</body>
</html>