<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  {% if page.description %}<meta name="description" content="{{ page.description }}"/>{% endif %}

  {% include "seo.njk" %}

  {%- assign bust = site.time | date: '%Y%m%d%H%M%S' -%}
  <link rel="stylesheet" href="{{ '/styles.css?v=' | append: bust | relative_url }}">
</head>
<body>
  {% include "header.html" %}

  <main class="container">
    {{ content }}

    <!-- Show support box on blog posts under /blog/, but not on /blog/ index -->
    {%- if page.url -%}
      {%- assign url_prefix = page.url | slice: 0, 6 -%} {# '/blog/' is 6 chars #}
      {%- if url_prefix == '/blog/' and page.url != '/blog/' -%}
        {% include "support.html" %}
      {%- endif -%}
    {%- endif -%}
  </main>

  {% include "footer.html" %}
  <script>
  (function(){
    const toggle = document.getElementById('navToggle');
    const menu   = document.getElementById('navMenu');
    if(!toggle || !menu) return;

    function setOpen(open){
      toggle.setAttribute('aria-expanded', String(open));
      toggle.setAttribute('aria-label', open ? 'Close menu' : 'Open menu');
      menu.classList.toggle('is-open', open);
      document.body.classList.toggle('nav-open', open);
    }

    toggle.addEventListener('click', () => {
      const open = toggle.getAttribute('aria-expanded') === 'true';
      setOpen(!open);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && toggle.getAttribute('aria-expanded') === 'true') setOpen(false);
    });
    document.addEventListener('click', (e) => {
      if (toggle.getAttribute('aria-expanded') === 'true' &&
          !menu.contains(e.target) && !toggle.contains(e.target)) setOpen(false);
    });
  })();
  </script>
</body>
</html>